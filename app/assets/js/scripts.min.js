/*!
 * fastshell
 * Fiercely quick and opinionated front-ends
 * https://HosseinKarami.github.io/fastshell
 * @author Hossein Karami
 * @version 1.0.5
 * Copyright 2016. MIT licensed.
 */
!function(t,e,o,n){"use strict";function i(){t(".toque-form").on("submit",function(){var e=h.child("messages");t(".toque-form").find(".js-toque-send").addClass("is-loading").attr("disabled",!0);var o=t(".toque-twitter").val().toString(),n=t(".toque-message").val().toString(),i=e.push();return i.set({tweetLink:o,text:n}),t(".toque-form").find(".js-toque-send").removeClass("is-loading").prop("disabled",!1),!1})}function a(){var t=h.getAuth();return!!t}function s(){t(".login-navbar").removeClass("hide"),t(".logout-navbar").removeClass("hide"),a()?(d(),t(".login-navbar").addClass("hide")):t(".logout-navbar").addClass("hide")}function r(t,e){t?console.log("Login Failed!",t):(console.log("Authenticated successfully with payload:",e),s())}function u(){t(".toque-login").on("submit",function(){var e=t(".login").val(),o=t(".password").val();return h.authWithPassword({email:e,password:o},r),!1}),t(".toque-logout").on("submit",function(e){return e.preventDefault(),h.unauth(),s(),t("#tweetList").html(""),!1})}function l(){t(".toque-register").on("submit",function(e){e.preventDefault();var o=t(".register").val(),n=t(".register-password").val();return h.createUser({email:o,password:n},function(t,e){t?console.log("Error creating user"):h.child("users").child(e.uid).set({email:o})}),!1})}function c(e){var o=t("#list-tweets").html(),n=Handlebars.compile(o),i=n(e);t("#tweetList").html(i)}function d(){var e=[];g.on("child_added",function(o){t("#tweetList").html("");var n=o.val(),i=o.key();e.push(n),n.id=i,c(e)}),g.on("child_removed",function(e){var o=e.key();t("[data-key="+o+"]").closest(".media").fadeOut()})}function f(){t(o).on("click",".js-toque-accept",function(){var e=t(this).data("url"),o=t(this).data("text"),n=t(this).data("key"),i=new RegExp("/^(?:https?://)?(?:www.)?twitter.com/(#!/)?[a-zA-Z0-9_]+$/i");i.test(e)||console.log("narf");var a={text:o,url:e};t.ajax({url:"https://whispering-ridge-55853.herokuapp.com/update",type:"POST",data:a}).done(function(t){console.log(t)}),g.child(n).remove()})}function m(){t(o).on("click",".js-toque-decline",function(){var e=t(this).data("key");g.child(e).remove()})}var v,h=new Firebase("https://so1toque.firebaseio.com/"),g=new Firebase("https://so1toque.firebaseio.com/messages"),p={fire:function(t,e,o){var i=v;e=e===n?"init":e,""!==t&&i[t]&&"function"==typeof i[t][e]&&i[t][e](o)},loadEvents:function(){var e=o.body.id;p.fire("common"),t.each(o.body.className.split(/\s+/),function(t,o){p.fire(o),p.fire(o,e)}),p.fire("common","finalize")}};t(function(){t(o).ready(p.loadEvents),v={home:{init:function(){i()}},admin:{init:function(){s(),u(),l(),a(),m(),f()}}}})}(jQuery,window,document);